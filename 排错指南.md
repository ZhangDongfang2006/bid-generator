# 投标生成系统 - 排错指南

## 概述

系统已集成完整的错误处理和日志记录功能，帮助您快速定位和解决问题。

## 主要功能

### 1. 错误日志记录

所有错误都会自动记录到日志文件中：
- 日志位置：`logs/error_YYYY-MM-DD.log`
- 日志包含：时间戳、错误上下文、错误类型、错误信息、完整堆栈跟踪

### 2. 调试模式

**调试模式**开关位于侧边栏的"调试工具"区域：

- **关闭状态**（默认）：只显示基本错误信息
- **开启状态**：显示详细的错误信息，包括：
  - 完整的堆栈跟踪
  - 会话状态信息
  - 错误日志下载选项

### 3. 错误查看页面

在侧边栏选择 **"🔍 错误日志"** 或点击 **"📋 查看错误日志"** 按钮，可以查看：
- 最近的错误列表
- 完整的错误日志内容
- 下载完整日志文件
- 清空错误日志

## 常见错误及解决方案

### 解析文件错误

#### 错误：`.doc` 格式文件无法解析

**错误信息：**
```
解析失败：不支持的文件格式
```

**解决方案：**
1. 将 `.doc` 文件在 Word 中打开
2. 选择"文件" → "另存为"
3. 选择格式为 `.docx`
4. 重新上传

#### 错误：权限被拒绝

**错误信息：**
```
解析失败：[Errno 13] Permission denied
```

**解决方案：**
1. 检查文件是否被其他程序打开
2. 关闭所有打开的文件
3. 检查文件权限，确保可读
4. 尝试复制文件到其他位置后上传

#### 错误：内存不足

**错误信息：**
```
解析失败：MemoryError
```

**解决方案：**
1. 减小文件大小（拆分成多个小文件）
2. 关闭其他占用内存的程序
3. 重启系统后重试

### 生成投标文件错误

#### 错误：模板文件缺失

**错误信息：**
```
生成失败：模板文件不存在
```

**解决方案：**
1. 检查 `templates/` 目录是否存在
2. 确保模板文件完整
3. 尝试重新安装或从备份恢复

#### 错误：缺少必要数据

**错误信息：**
```
生成失败：KeyError: 'project_name'
```

**解决方案：**
1. 确保已正确解析招标文件
2. 检查招标文件是否包含必要信息
3. 在"资料管理"中完善公司数据

#### 错误：无法写入输出文件

**错误信息：**
```
生成失败：[Errno 13] Permission denied
```

**解决方案：**
1. 检查 `output/` 目录权限
2. 确保有写入权限
3. 检查磁盘空间是否充足

### 资料管理错误

#### 错误：数据库文件损坏

**错误信息：**
```
JSONDecodeError: Expecting value: line 1 column 1
```

**解决方案：**
1. 备份 `data/` 目录
2. 从备份恢复数据库文件
3. 或在"系统设置"中重置数据

## 使用调试模式

### 开启调试模式

1. 在侧边栏找到"调试工具"
2. 点击"🐛 调试模式"按钮
3. 调试模式开启后，按钮会变为高亮状态

### 在调试模式下操作

当出现错误时：

1. **查看详细错误信息**
   - 点击"🔍 详细错误信息（调试模式）"展开框
   - 查看完整的堆栈跟踪

2. **查看会话状态**
   - 了解当前的执行步骤
   - 检查哪些数据已加载

3. **下载错误日志**
   - 点击"📥 下载完整错误日志"
   - 保存日志文件以便分析或反馈

### 关闭调试模式

再次点击"🐛 调试模式"按钮即可关闭。

## 查看错误历史

### 通过侧边栏

1. 点击"📋 查看错误日志"按钮
2. 或在导航中选择"🔍 错误日志"

### 查看最近错误

1. 打开"错误日志"页面
2. 查看每个错误展开框中的信息
3. 包括时间、上下文、错误类型、错误信息

### 查看完整日志

1. 在"错误日志"页面
2. 使用滑块选择显示的行数
3. 或点击"📥 下载完整错误日志"下载

### 清空日志

1. 在"错误日志"页面
2. 点击"🗑️ 清空错误日志"按钮
3. 再次点击确认
4. 注意：此操作不可恢复

## 获取帮助

### 自动提示

系统会根据错误类型给出相应的提示建议：
- 💡 提示：具体的解决方案或建议

### 反馈错误

如果遇到无法解决的问题：

1. 开启调试模式
2. 复现错误
3. 下载错误日志
4. 记录操作步骤
5. 联系技术支持并提供：
   - 错误日志
   - 操作步骤
   - 上传的文件（如果可以）

## 最佳实践

1. **定期备份数据**
   - 备份 `data/` 目录
   - 备份重要生成的文件

2. **及时查看日志**
   - 发现问题后立即查看错误日志
   - 不要等到问题积累

3. **使用调试模式**
   - 遇到问题时开启调试模式
   - 问题解决后关闭调试模式

4. **保持系统更新**
   - 定期更新系统
   - 检查是否有新版本

## 测试错误处理

可以使用测试脚本验证错误处理功能：

```bash
cd ~/workspace/bid-generator
python3 test_error_handler.py
```

测试内容包括：
- 基本错误记录
- 文件不存在错误
- 字典键错误
- 获取最近的错误
- 获取日志内容

## 技术细节

### 日志级别

- **DEBUG**: 详细的调试信息
- **INFO**: 一般信息
- **WARNING**: 警告信息
- **ERROR**: 错误信息（控制台显示）

### 日志格式

```
YYYY-MM-DD HH:MM:SS - BidGenerator - LEVEL - 错误信息
```

### 错误处理流程

1. 发生异常
2. 捕获异常
3. 记录到日志文件
4. 显示错误信息给用户
5. 提供解决方案建议（调试模式）
6. 提供日志下载选项（调试模式）

---

**最后更新**: 2026-02-13
**版本**: V1.0
